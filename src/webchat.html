<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Web Chat Bot</title>
    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #ece5dd;
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #container {
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            height: 90vh;
            width: 100vw;
        }

        #chat {
            width: 100%;
            max-width: 500px;
            height: 70vh;
            background-color: #efe6dd;
            background-image: url("https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png");
            background-repeat: repeat;
            background-size: contain;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            overflow-y: auto;
            margin: 0 auto 10px auto;
            display: flex;
            flex-direction: column;
        }


        #chat .msg {
            display: inline-block;
            width: fit-content;
            max-width: 78%;
            padding: 9px 12px;
            margin: 6px 0;
            border-radius: 18px;
            line-height: 1.35;
            font-size: 15px;
            word-break: break-word;
            white-space: pre-wrap;
            box-shadow: 0 1px 1px rgba(0, 0, 0, .25);
            color: #e9edef;
        }

        .bot {
            background: #202c33;
            margin-right: auto;
            align-self: flex-start;
            text-align: left;
            border-top-left-radius: 6px;
        }

        .user {
            background: #005c4b;
            margin-left: auto;
            align-self: flex-end;
            text-align: left;
            border-top-right-radius: 6px;
        }

        #input,
        #send {
            padding: 14px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 1.1em;
        }

        #input {
            flex: 1;
            min-height: 45px;
            max-height: 120px;
            padding: 10px 14px;
            border-radius: 50px;
            border: 1px solid #fff;
            background: #fff;
            resize: none;
            overflow-y: auto;
            line-height: 1.4;
            font-size: 1em;
            color: #111;
            box-sizing: border-box;
            transition: none;
        }

        #input:focus {
            border: 1px solid #fff;
            outline: none;
            box-shadow: none;
        }

        #input::placeholder {
            color: #999;
        }

        #send {
            width: 45px;
            height: 45px;
            min-width: 45px;
            min-height: 45px;
            background: #25d366;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #send:hover {
            background: #128c7e;
        }

        #send::before {
            content: "";
            display: block;
            width: 20px;
            height: 20px;
            background: url('https://www.iconpacks.net/icons/2/free-icon-send-4008.png') no-repeat center;
            background-size: contain;
        }

        #inputRow {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }

        /* Scrollbar estilo WhatsApp */
        #chat::-webkit-scrollbar {
            width: 6px;
        }

        #chat::-webkit-scrollbar-track {
            background: transparent;
        }

        #chat::-webkit-scrollbar-thumb {
            background-color: rgba(0, 0, 0, 0.15);
            border-radius: 3px;
        }

        #chat::-webkit-scrollbar-thumb:hover {
            background-color: rgba(0, 0, 0, 0.3);
        }

        /* Firefox */
        #chat {
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 0, 0, 0.15) transparent;
        }

        /* ========================= */
        /*        RESPONSIVE         */
        /* ========================= */

        /* 600px */
        @media (max-width: 600px) {
            body {
                justify-content: flex-start;
            }

            #container {
                height: 100vh;
                justify-content: space-between;
            }

            #chat {
                max-width: 100%;
                border-radius: 0;
                height: calc(100vh - 95px);
                padding: 12px;
                background-size: 320px 320px;
            }

            #inputRow {
                max-width: 100%;
                padding: 8px 10px;
                gap: 10px;
                background: rgba(236, 229, 221, 0.75);
                backdrop-filter: blur(2px);
            }

            #input {
                min-height: 44px;
                font-size: 16px;
                padding: 10px 14px;
            }

            #send {
                width: 48px;
                height: 48px;
                min-width: 48px;
                min-height: 48px;
            }

            #chat .msg {
                max-width: 85%;
                font-size: 14.5px;
            }
        }

        /* 560px */
        @media (max-height: 560px) {
            #container {
                height: 100vh;
            }

            #chat {
                height: calc(100vh - 85px);
                padding: 10px;
            }

            #input {
                max-height: 96px;
            }
        }

        /* 768px */
        @media (min-width: 768px) {
            #chat {
                max-width: 640px;
            }

            #inputRow {
                max-width: 640px;
            }

            #chat .msg {
                max-width: 72%;
            }
        }

        /* 1200px */
        @media (min-width: 1200px) {
            #chat {
                max-width: 720px;
                background-size: 420px 420px;
            }

            #inputRow {
                max-width: 720px;
            }
        }
    </style>
</head>

<body>
    <div id="container">
        <div id="chat"></div>
        <div id="inputRow">
            <textarea id="input" placeholder="Escribe un mensaje..." autocomplete="off"></textarea>
            <button id="send"></button>
        </div>
    </div>

    <script>

        const textarea = document.getElementById('input');
        const input = document.getElementById('input');
        const sendBtn = document.getElementById('send');

        // === Auto-grow con altura mínima y reset ===
        const MIN_H = 45; // px
        function autosize(el) {
            el.style.height = 'auto';
            el.style.height = Math.max(el.scrollHeight, MIN_H) + 'px';
        }
        autosize(textarea);
        textarea.addEventListener('input', function () { autosize(this); });

        async function sendMessage() {
            const msg = input.value.trim();
            if (!msg) return;
            addMessage(msg, 'user');
            input.value = '';
            textarea.style.height = MIN_H + 'px'; // reset a altura base

            try {
                const res = await fetch('/webchat-api', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: msg })
                });
                const data = await res.json();
                addMessage(data.reply, 'bot');
            } catch (err) {
                addMessage('Hubo un error procesando tu mensaje.', 'bot');
            }
        }

        // Enter envía / Shift+Enter = nueva línea
        sendBtn.onclick = sendMessage;
        input.addEventListener('keydown', function (e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        function addMessage(text, type) {
            const div = document.createElement('div');
            div.className = 'msg ' + type;
            div.innerText = text;
            const chat = document.getElementById('chat');
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }
    </script>
</body>

</html>